<html>
  <head>
    <title>Fever Metrics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link rel="icon" type="image/x-icon" href="favicon-32x32.png" />
  </head>
  <body>
    <% 
    function getLastMonday() {
      var t = new Date();
      t.setDate(t.getDate() - t.getDay() + 1);
      return t.toISOString().slice(0, 10);
    }
    function getThisSunday() {
      var t = new Date();
      t.setDate(t.getDate() - t.getDay() + 7);
      return t.toISOString().slice(0, 10);
    }
    %>
    <form action="/feverMetrics" method="get">
      <table id="date-form">
        <tr>
          <td>Show data from</td>
          <td>
            <input name="startDate" type="text" value="<%= startDate %>" />
          </td>
          <td>to</td>
          <td><input name="endDate" type="text" value="<%= endDate %>" /></td>
          <td><button type="submit">Go</button></td>
          <td><input type="button" onClick="location.href='/feverMetrics';" value="Today"></td>
          <td><input type="button" onClick="location.href='/feverMetrics?startDate=<%=getLastMonday()%>&amp;endDate=<%=getThisSunday()%>';" value="This Week"></td>
        </tr>
      </table>
    </form>
    <a href="/saveFeverMetrics?startDate=<%=startDate%>&endDate=<%=endDate%>">Download Excel metrics report</a> 
    <br />
    <br />
    <a href="/saveFeverDataSummary?startDate=<%=startDate%>&endDate=<%=endDate%>">Download Excel data summary report</a>
    <br />
    <br />
    <h1>Fever Survey Stats</h1>
    <% queryTypes=[{key: "Location", data:surveyStatsData}];
       for (let queryType of queryTypes) { %>
    <table class="hor-zebra">
      <thead>
        <tr>
          <th><label title="How many surveys started">Started Part 1</label></th>
          <th><label title="How many eligible to participate">Eligible</label></th>
          <th><label title="How many consented to participate">Consented</label></th>
          <th><label title="How many kits ordered">Ordered Kit</label></th>
          <th><label title="How many started part 2">Started Part 2</label></th>
          <th><label title="Total scanned the barcode">Barcode Scanned</label></th>
          <th><label title="How many completed test 1">Test 1 Complete</label></th>
          <th><label title="How many completed the questionnaire">Completed Questionnaire</label></th>
          <th><label title="Total many completed test 2">Test 2 Completed</label></th>
          <th><label title="How many returned the kit">Kit Returned</label></th>
        </tr>
      </thead>
      <tbody>
        <% oddRow = true;
           queryType.data.forEach(function(row) { 
            if (row.grouping === "Total") {
          %>
        <tr class="sum">
          <% } else if (oddRow) { %>
        <tr class="odd">
          <% } else { %>
        <tr>
          <% } %> 
          <td class="label"><%= row.total %></td>
          <td><%= row.consents %></td>
          <td><%= row.eligible %></td>
          <td><%= row.consented %></td>
          <td><%= row.completed %></td>
          <td><%= row.specimenscanned %></td>
          <td><%= row.giftcards %></td>
          <td><%= row.adverseevents %></td>
          <% if (queryType.key === "Location") { %>
          <td class="sectionbreak"><%= row.questionsanswered %></td>
          <td><%= row.declinedresponses %></td>
          <% } %>
        </tr>
        <% oddRow = !oddRow; 
          }); %>
        </tr>
      </tbody>
    </table>
    <br />
    <% } %>

  </body>
</html>
